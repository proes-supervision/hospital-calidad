<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SGCO - Sistema de Gestión de Calidad en Obra</title>
    <!-- Incluir Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilo simple para el spinner */
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .animate-spin { display: inline-block; animation: spin 1s linear infinite; }
        /* Ocultar vistas por defecto */
        .view { display: none; }
        #view-dashboard { display: block; } /* Mostrar Dashboard al inicio */
    </style>
</head>
<body class="bg-gray-100 font-sans" id="app-body">

    <div class="container mx-auto p-4 md:p-8">
        <!-- Cabecera -->
        <header class="mb-6">
            <h1 class="text-3xl font-bold text-blue-900">Sistema de Gestión de Calidad en Obra (SGCO)</h1>
            <p class="text-xl text-gray-600">Proyecto: Hospital de Segundo Nivel Isaías</p>
        </header>

        <!-- Notificador de Estado -->
        <div id="upload-status" class="hidden mb-4 p-3 text-center text-sm text-white rounded-md shadow-lg transition-all duration-300"></div>

        <!-- Navegación de Pestañas (Vistas) -->
        <div class="border-b border-gray-300 mb-6">
            <nav class="flex -mb-px space-x-6">
                <button id="btn-tab-dashboard" onclick="showView('dashboard')" class="py-3 px-1 border-b-4 font-medium text-blue-600 border-blue-600 focus:outline-none">
                    Dashboard (RNC Abiertas)
                </button>
                <button id="btn-tab-inspeccion" onclick="showView('inspeccion')" class="py-3 px-1 border-b-4 font-medium text-gray-600 hover:text-blue-600 hover:border-blue-600 border-transparent focus:outline-none">
                    Registrar Inspección
                </button>
            </nav>
        </div>

        <!-- VISTA 1: DASHBOARD DE RNCs ABIERTAS -->
        <div id="view-dashboard" class="view">
            <section>
                <h2 class="text-xl font-semibold text-gray-800 mb-3">Reporte de No Conformidades (RNCs) Abiertas</h2>
                <div class="bg-white shadow-lg rounded-lg overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="p-3 text-left text-xs font-semibold text-gray-600 uppercase">Fecha</th>
                                    <th class="p-3 text-left text-xs font-semibold text-gray-600 uppercase">Protocolo</th>
                                    <th class="p-3 text-left text-xs font-semibold text-gray-600 uppercase">Área</th>
                                    <th class="p-3 text-left text-xs font-semibold text-gray-600 uppercase">Defecto</th>
                                    <th class="p-3 text-left text-xs font-semibold text-gray-600 uppercase">Responsable</th>
                                    <th class="p-3 text-center text-xs font-semibold text-gray-600 uppercase">Evidencia</th>
                                    <th class="p-3 text-center text-xs font-semibold text-gray-600 uppercase">Acción</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200" id="rnc-table-body">
                                <!-- Filas generadas por JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </div>

        <!-- VISTA 2: FORMULARIO DE NUEVA INSPECCIÓN -->
        <div id="view-inspeccion" class="view">
            <div class="bg-white p-6 rounded-lg shadow-lg">
                
                <!-- Paso 1: Seleccionar Protocolo -->
                <form id="form-step-1" class="space-y-4">
                    <h2 class="text-xl font-semibold text-gray-800">Paso 1: Iniciar Inspección</h2>
                    <div>
                        <label for="insp-protocolo" class="block text-sm font-medium text-gray-700">Seleccione el Protocolo a Inspeccionar</label>
                        <select id="insp-protocolo" name="insp-protocolo" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            <option value="">Cargando protocolos...</option>
                        </select>
                    </div>
                    <div>
                        <label for="insp-area" class="block text-sm font-medium text-gray-700">Área / Sector de Inspección</label>
                        <input type="text" id="insp-area" name="insp-area" placeholder="Ej: Bloque B, Piso 2, Eje 4-5" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                    <div>
                        <label for="insp-supervisor" class="block text-sm font-medium text-gray-700">Nombre del Supervisor (Inspector)</label>
                        <input type="text" id="insp-supervisor" name="insp-supervisor" placeholder="Ej: Ing. Juan Perez" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                    <div class="text-right">
                        <button type="submit" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg shadow-lg hover:bg-blue-700">
                            Cargar Checklist
                        </button>
                    </div>
                </form>

                <!-- Paso 2: Ejecutar Checklist (Oculto) -->
                <form id="form-step-2" class="space-y-6 hidden">
                    <h2 class="text-xl font-semibold text-gray-800">Paso 2: Ejecutar Checklist para <span id="checklist-title" class="text-blue-700"></span></h2>
                    <div id="checklist-items-container" class="space-y-3">
                        <!-- Items de checklist generados por JS -->
                    </div>
                    
                    <!-- Paso 3: Formulario RNC (Oculto, solo aparece si algo es Rechazado) -->
                    <div id="rnc-form-container" class="hidden mt-6 p-4 bg-red-50 border-l-4 border-red-500 rounded-lg">
                        <h3 class="text-lg font-bold text-red-800">¡Inspección RECHAZADA!</h3>
                        <p class="text-red-700">Se requiere una No Conformidad (RNC) para los ítems rechazados.</p>
                        <div class="space-y-3 mt-4">
                            <div>
                                <label for="rnc-defecto" class="block text-sm font-medium text-gray-700">Descripción del Defecto (Resumido)</label>
                                <textarea id="rnc-defecto" name="rnc-defecto" rows="3" placeholder="Ej: Estribos en Viga V-102 con separación de 25cm en lugar de 15cm." class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></textarea>
                            </div>
                            <div>
                                <label for="rnc-responsable" class="block text-sm font-medium text-gray-700">Responsable de la Corrección</label>
                                <input type="text" id="rnc-responsable" name="rnc-responsable" placeholder="Ej: Contratista Z&Z" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                            </div>
                            <div>
                                <label for="rnc-foto" class="block text-sm font-medium text-gray-700">Evidencia (Foto del Defecto)</label>
                                <input type="file" id="rnc-foto" name="rnc-foto" accept="image/*" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:font-semibold file:bg-red-100 file:text-red-700 hover:file:bg-red-200">
                            </div>
                        </div>
                    </div>

                    <!-- Botones Finales -->
                    <div class="flex justify-end gap-3 pt-4 border-t">
                         <button type="button" id="cancel-checklist-btn" class="bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-300">Cancelar</button>
                        <button type="submit" id="submit-inspection-btn" class="bg-green-600 text-white font-bold py-2 px-6 rounded-lg shadow-lg hover:bg-green-700">
                            Finalizar Inspección (Aprobar)
                        </button>
                    </div>
                </form>

            </div>
        </div>

        <!-- Pie de página -->
        <footer class="mt-12 pt-6 border-t border-gray-300 text-center text-sm text-gray-500">
            <p>
                Desarrollado por Zacarias Ortega para el Proyecto Construcción Hospital de Segundo Nivel Isaías - Oruro
            </l>
        </footer>
    </div>

    <!-- Script principal del aplicativo (v1.0 - Calidad con Google Sheets) -->
    <script>
        // -----------------------------------------------------------------
        // SCRIPT v1.0: LÓGICA DEL APLICATIVO DE CALIDAD
        // -----------------------------------------------------------------

        // ¡¡¡IMPORTANTE!!! Usted deberá pegar aquí la URL de su API de Google Apps Script
        const G_APP_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz6dKnjs_wiOGKruFFIQbrcZbibA4tUxWJLDZyfRJ9TK40MmGU9b-x6HR_6AL7ApH5gGg/exec";

        // Variables globales
        let currentProtocolos = [];
        let currentChecklist = [];
        let currentInspectionData = {};

        // --- Funciones de Utilidad ---
        function showNotification(message, type = 'info') {
            const statusEl = document.getElementById('upload-status');
            if (!statusEl) return;
            statusEl.classList.remove('hidden', 'bg-blue-500', 'bg-red-500', 'bg-green-500');
            if (type === 'error') statusEl.classList.add('bg-red-500');
            else if (type === 'success') statusEl.classList.add('bg-green-500');
            else statusEl.classList.add('bg-blue-500');
            statusEl.textContent = message;
            statusEl.classList.remove('hidden');
            setTimeout(() => statusEl.classList.add('hidden'), 4000);
        }
        
        // Convertir archivo a Base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result.split(',')[1]); // Solo la data Base64
                reader.onerror = error => reject(error);
            });
        }
        
        // Romper la caché de Google Apps Script
        function getCacheBustUrl(url) {
            const cacheBust = new Date().getTime();
            // Comprueba si la URL ya tiene parámetros
            const separator = url.includes('?') ? '&' : '?';
            return `${url}${separator}cacheBust=${cacheBust}`;
        }

        // --- Control de Vistas ---
        function showView(viewName) {
            document.querySelectorAll('.view').forEach(v => v.style.display = 'none');
            document.getElementById(`view-${viewName}`).style.display = 'block';
            
            document.querySelectorAll('nav button').forEach(b => {
                b.classList.remove('text-blue-600', 'border-blue-600');
                b.classList.add('text-gray-600', 'border-transparent');
            });
            document.getElementById(`btn-tab-${viewName}`).classList.add('text-blue-600', 'border-blue-600');

            if (viewName === 'dashboard') loadRNCs();
            if (viewName === 'inspeccion') resetFormStep1();
        }
        
        function resetFormStep1() {
            document.getElementById('form-step-1').classList.remove('hidden');
            document.getElementById('form-step-2').classList.add('hidden');
            document.getElementById('rnc-form-container').classList.add('hidden');
            document.getElementById('form-step-1').reset();
            currentChecklist = [];
            currentInspectionData = {};
        }

        // --- Lógica de Carga de Datos (GET) ---

        async function loadProtocolos() {
            try {
                if (G_APP_SCRIPT_URL === "PEGUE_SU_URL_DE_APPS_SCRIPT_AQUI") {
                    if (window.location.protocol === 'blob:') {
                         document.getElementById('insp-protocolo').innerHTML = '<option value="">Modo Simulación: Conecte API</option>';
                         return;
                    }
                    throw new Error("API URL no configurada.");
                }
                const url = getCacheBustUrl(`${G_APP_SCRIPT_URL}?action=getProtocolos`);
                const response = await fetch(url);
                const data = await response.json();
                if (data.status !== 'success') throw new Error(data.message);
                
                currentProtocolos = data.protocolos;
                const select = document.getElementById('insp-protocolo');
                select.innerHTML = '<option value="">Seleccione un protocolo...</option>';
                
                // Asegurarse de que el protocolo_id y nombre_protocolo existan en los datos
                if(currentProtocolos.length > 0 && !currentProtocolos[0].protocolo_id) {
                    console.warn("Datos de protocolo recibidos, pero faltan cabeceras 'protocolo_id' o 'nombre_protocolo' en el Google Sheet 'Biblioteca_Protocolos'.");
                    showNotification("Error: Revise las cabeceras en su Google Sheet 'Biblioteca_Protocolos'.", 'error');
                    return;
                }

                currentProtocolos.forEach(p => {
                    const option = document.createElement('option');
                    option.value = p.protocolo_id;
                    option.textContent = p.nombre_protocolo;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error("Error al cargar protocolos:", error);
                showNotification("Error al cargar protocolos: " + error.message, 'error');
            }
        }

        async function loadRNCs() {
            const tableBody = document.getElementById('rnc-table-body');
            tableBody.innerHTML = '<tr><td colspan="7" class="p-4 text-center">Cargando RNCs abiertas...</td></tr>';
            try {
                if (G_APP_SCRIPT_URL === "PEGUE_SU_URL_DE_APPS_SCRIPT_AQUI") {
                    if (window.location.protocol === 'blob:') {
                         tableBody.innerHTML = '<tr><td colspan="7" class="p-4 text-center text-gray-500">Modo simulación. Conecte API.</td></tr>';
                         return;
                    }
                    throw new Error("API URL no configurada.");
                }
                const url = getCacheBustUrl(`${G_APP_SCRIPT_URL}?action=getRNCs`);
                const response = await fetch(url);
                const data = await response.json();
                if (data.status !== 'success') throw new Error(data.message);
                
                tableBody.innerHTML = '';
                if (data.rncs.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="7" class="p-4 text-center text-gray-500">¡Felicidades! No hay No Conformidades abiertas.</td></tr>';
                }
                
                data.rncs.forEach(rnc => {
                    const row = document.createElement('tr');
                    const fotoHtml = rnc.foto_url ? `<a href="${rnc.foto_url}" target="_blank" class="text-blue-600 hover:underline">Ver Foto</a>` : 'No/Disp';
                    row.innerHTML = `
                        <td class="p-3 text-sm text-gray-700">${rnc.fecha_hora}</td>
                        <td class="p-3 text-sm text-gray-700">${rnc.protocolo_id}</td>
                        <td class="p-3 text-sm text-gray-700">${rnc.area}</td>
                        <td class="p-3 text-sm text-red-700">${rnc.defecto}</td>
                        <td class="p-3 text-sm text-gray-700">${rnc.responsable}</td>
                        <td class="p-3 text-sm text-center">${fotoHtml}</td>
                        <td class="p-3 text-sm text-center">
                            <button onclick="window.closeRNC(this, '${rnc.fecha_hora}', '${rnc.defecto}')" class="bg-green-600 text-white text-xs font-bold py-1 px-2 rounded hover:bg-green-700">
                                Cerrar RNC
                            </button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
                
            } catch (error) {
                console.error("Error al cargar RNCs:", error);
                showNotification("Error al cargar RNCs: " + error.message, 'error');
            }
        }

        // --- Lógica de Formularios (POST) ---

        // Paso 1: Cargar el checklist
        async function handleLoadChecklist(e) {
            e.preventDefault();
            const protocoloId = document.getElementById('insp-protocolo').value;
            const area = document.getElementById('insp-area').value;
            const supervisor = document.getElementById('insp-supervisor').value;
            
            if (!protocoloId || !area || !supervisor) {
                showNotification("Por favor, complete todos los campos del Paso 1.", 'error');
                return;
            }

            currentInspectionData = { protocoloId, area, supervisor };
            
            const btn = e.target.querySelector('button[type="submit"]');
            btn.disabled = true;
            btn.innerHTML = '<span class="animate-spin mr-2">&#9696;</span> Cargando...';
            
            try {
                const url = getCacheBustUrl(`${G_APP_SCRIPT_URL}?action=getChecklist&protocoloId=${protocoloId}`);
                const response = await fetch(url);
                const data = await response.json();
                if (data.status !== 'success') throw new Error(data.message);
                
                currentChecklist = data.checklist;
                const container = document.getElementById('checklist-items-container');
                container.innerHTML = '';
                
                if (currentChecklist.length === 0) {
                    container.innerHTML = '<p class="text-red-500">Error: No se encontraron ítems de checklist para este protocolo en la base de datos (Hoja: Biblioteca_Checklists).</p>';
                    btn.disabled = false;
                    btn.innerHTML = 'Cargar Checklist';
                    return;
                }
                
                currentChecklist.forEach((item, index) => {
                    const itemHtml = `
                        <div class="p-3 border rounded-md bg-gray-50">
                            <label class="block text-sm font-medium text-gray-800">${item.item_descripcion}</label>
                            <p class="text-xs text-gray-500 mb-2">Especificación: ${item.especificacion || 'N/A'}</p>
                            <div class="flex space-x-4">
                                <label class="flex items-center"><input type="radio" name="item-${index}" value="Aprobado" class="mr-1" required onchange="window.checkIfRejected()"> Aprobado</label>
                                <label class="flex items-center"><input type="radio" name="item-${index}" value="Rechazado" class="mr-1" onchange="window.checkIfRejected()"> Rechazado</label>
                                <label class="flex items-center"><input type="radio" name="item-${index}" value="N/A" class="mr-1" onchange="window.checkIfRejected()"> N/A</label>
                            </div>
                        </div>
                    `;
                    container.innerHTML += itemHtml;
                });

                document.getElementById('form-step-1').classList.add('hidden');
                document.getElementById('form-step-2').classList.remove('hidden');
                document.getElementById('checklist-title').textContent = protocoloId;

            } catch (error) {
                console.error("Error al cargar checklist:", error);
                showNotification("Error al cargar checklist: " + error.message, 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'Cargar Checklist';
            }
        }
        
        // Se llama cada vez que se marca un radio button
        window.checkIfRejected = () => {
            const form = document.getElementById('form-step-2');
            const formData = new FormData(form);
            let isRejected = false;
            for (const [key, value] of formData.entries()) {
                if (value === 'Rechazado') {
                    isRejected = true;
                    break;
                }
            }
            
            const rncContainer = document.getElementById('rnc-form-container');
            const submitBtn = document.getElementById('submit-inspection-btn');
            
            if (isRejected) {
                rncContainer.classList.remove('hidden');
                submitBtn.textContent = 'Finalizar Inspección (Generar RNC)';
                submitBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
                submitBtn.classList.add('bg-red-600', 'hover:bg-red-700');
            } else {
                rncContainer.classList.add('hidden');
                submitBtn.textContent = 'Finalizar Inspección (Aprobar)';
                submitBtn.classList.add('bg-green-600', 'hover:bg-green-700');
                submitBtn.classList.remove('bg-red-600', 'hover:bg-red-700');
            }
        }
        window.checkIfRejected = window.checkIfRejected; // Exponerlo globalmente

        // Paso 2: Guardar la inspección
        async function handleSaveInspection(e) {
            e.preventDefault();
            const btn = e.target.querySelector('button[type="submit"]');
            
            // 1. Recolectar resultados del checklist
            const form = document.getElementById('form-step-2');
            const formData = new FormData(form);
            let isRejected = false;
            let itemsResult = [];
            let allAnswered = true;
            
            for (let i = 0; i < currentChecklist.length; i++) {
                const resultado = formData.get(`item-${i}`);
                if (!resultado) {
                    allAnswered = false;
                    break;
                }
                if (resultado === 'Rechazado') isRejected = true;
                itemsResult.push({ item: currentChecklist[i].item_descripcion, resultado: resultado });
            }

            if (!allAnswered) {
                 showNotification("Por favor, responda todos los ítems del checklist.", 'error');
                 return;
            }
            
            const payload = {
                action: "saveInspeccion",
                protocoloId: currentInspectionData.protocoloId,
                area: currentInspectionData.area,
                supervisor: currentInspectionData.supervisor,
                resultado: isRejected ? "Rechazado" : "Aprobado",
                items: itemsResult,
                rnc: {}
            };

            // 2. Si es Rechazado, recolectar datos de RNC
            if (isRejected) {
                const rncDefecto = document.getElementById('rnc-defecto').value;
                const rncResponsable = document.getElementById('rnc-responsable').value;
                const rncFotoInput = document.getElementById('rnc-foto');
                
                if (!rncDefecto || !rncResponsable) {
                    showNotification("Si la inspección es Rechazada, debe llenar la descripción del defecto y el responsable.", 'error');
                    return; // Detener el guardado
                }
                
                payload.rnc.defecto = rncDefecto;
                payload.rnc.responsable = rncResponsable;
                
                if (rncFotoInput.files[0]) {
                    showNotification("Procesando foto de evidencia...", 'info');
                    payload.rnc.fileData = await fileToBase64(rncFotoInput.files[0]);
                    payload.rnc.fileName = rncFotoInput.files[0].name;
                    payload.rnc.fileType = rncFotoInput.files[0].type;
                }
            }

            // 3. Enviar todo al "Mesero" (Apps Script)
            btn.disabled = true;
            btn.innerHTML = '<span class="animate-spin mr-2">&#9696;</span> Guardando...';

            try {
                if (G_APP_SCRIPT_URL === "PEGUE_SU_URL_DE_APPS_SCRIPT_AQUI") {
                    throw new Error("API URL no configurada.");
                }

                const response = await fetch(G_APP_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'cors',
                    redirect: 'follow',
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify(payload)
                });
                
                const result = await response.json();
                if (response.status !== 200 || result.status !== 'success') {
                    throw new Error(result.message || 'Error en el servidor de Apps Script');
                }

                showNotification(isRejected ? "RNC generada con éxito." : "Inspección Aprobada con éxito.", 'success');
                showView('dashboard'); // Volver al dashboard (que ahora mostrará la nueva RNC)
                
            } catch (error) {
                console.error("Error al guardar inspección:", error);
                showNotification("Error al guardar: " + error.message, 'error');
            } finally {
                btn.disabled = false;
                checkIfRejected(); // Resetea el texto y color del botón
            }
        }

        // Cerrar una RNC
        async function closeRNC(buttonEl, fecha_hora, defecto) {
            // Re-codificar el defecto por si tiene caracteres especiales
            const safeDefecto = encodeURIComponent(defecto);
            
            if (!confirm(`¿Está seguro de que desea CERRAR esta No Conformidad?\n\nDefecto: ${decodeURIComponent(safeDefecto)}`)) {
                return;
            }

            buttonEl.disabled = true;
            buttonEl.textContent = 'Cerrando...';
            
            try {
                if (G_APP_SCRIPT_URL === "PEGUE_SU_URL_DE_APPS_SCRIPT_AQUI") {
                    throw new Error("API URL no configurada.");
                }

                const payload = {
                    action: "closeRNC",
                    fecha_hora: fecha_hora, // Usamos la fecha y el defecto como un "ID" compuesto
                    defecto: decodeURIComponent(safeDefecto)
                };
                
                const response = await fetch(G_APP_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'cors',
                    redirect: 'follow',
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify(payload)
                });
                
                const result = await response.json();
                if (response.status !== 200 || result.status !== 'success') {
                    throw new Error(result.message || 'Error en el servidor de Apps Script');
                }
                
                showNotification("RNC cerrada con éxito.", 'success');
                loadRNCs(); // Recargar la tabla del dashboard
                
            } catch (error) {
                console.error("Error al cerrar RNC:", error);
                showNotification("Error al cerrar RNC: " + error.message, 'error');
                buttonEl.disabled = false;
                buttonEl.textContent = 'Cerrar RNC';
            }
        }
        // Exponer la función al scope global
        window.closeRNC = (el, fecha, defecto) => closeRNC(el, fecha, encodeURIComponent(defecto));
        window.showView = showView;


        // --- Event Listeners Globales ---
        document.addEventListener('DOMContentLoaded', () => {
            // Configuración inicial
            if (G_APP_SCRIPT_URL === "PEGUE_SU_URL_DE_APPS_SCRIPT_AQUI") {
                 if (window.location.protocol !== 'blob:') {
                    showNotification("Error: El aplicativo no está conectado. Configure la URL de la API.", 'error');
                 }
            } else {
                loadProtocolos(); // Cargar la lista de protocolos para el formulario
                loadRNCs(); // Cargar el dashboard
            }
            
            // Listeners de Formularios
            document.getElementById('form-step-1').addEventListener('submit', handleLoadChecklist);
            document.getElementById('form-step-2').addEventListener('submit', handleSaveInspection);
            document.getElementById('cancel-checklist-btn').addEventListener('click', () => showView('inspeccion'));
        });

    </script>
</body>
</html>
